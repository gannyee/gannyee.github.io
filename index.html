<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>gannyee&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="成长在于积累，分享是种美德！">
<meta property="og:type" content="website">
<meta property="og:title" content="gannyee's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="gannyee's Blog">
<meta property="og:description" content="成长在于积累，分享是种美德！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="gannyee's Blog">
<meta name="twitter:description" content="成长在于积累，分享是种美德！">
  
    <link rel="alternate" href="/atom.xml" title="gannyee&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">gannyee&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">成长在于积累，分享是种美德！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Nutch+MongoDB+ElasticSearch+Kibana 搭建搜索引擎" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/16/Nutch+MongoDB+ElasticSearch+Kibana 搭建搜索引擎/" class="article-date">
  <time datetime="2016-09-16T15:39:09.584Z" itemprop="datePublished">2016-09-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Exercise-在此处输入这篇文章的分类。/">Exercise   //在此处输入这篇文章的分类。</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/16/Nutch+MongoDB+ElasticSearch+Kibana 搭建搜索引擎/">hello-world   //在此处添加你的标题。</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p></p><h5><strong>前言：</strong><p></p>
<blockquote>
<p>文章讲述如何通过Nutch、MongoDB、ElasticSearch、Kibana搭建网络爬虫，其中Nutch用于网页数据爬取，MongoDB用于存储爬虫而来的数据，ElasticSearch用来作Index索引，Kibana用来形象化查看索引结果。具体步骤如下：</p>
</blockquote>
<p></p><h5><strong>配置环境：</strong><p></p>
<p><strong>系统环境：Ubuntu 14.04</strong></p>
<p><strong>JDK版本：jdk1.8.0_45</strong><br>通过wget获取下载安装包:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$ wget https://www.reucon.com/cdn/java/jdk-8u45-linux-x64.tar.gz</div><div class="line">tar zxvf jdk-8u45-linux-x64.tar.gz</div></pre></td></tr></table></figure></p>
<p>解压后得到jdk1.8.0_45这个文件夹，先查看/usr/lib/路径下有没有jvm这个文件夹，若没有，则新建一个jvm文件夹：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$ mkdir /usr/lib/jvm</div></pre></td></tr></table></figure>
<p>将当前解压得到的jdk1.8.0_45复制到/usr/lib/jvm中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$mv jdk1.8.0_45 /usr/lib/jvm</div></pre></td></tr></table></figure>
<p>打开profile设置环境变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$vim /etc/profile</div></pre></td></tr></table></figure></p>
<p>在profile的末尾加入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">export JAVA_HOME=/usr/lib/jvm/jdk1.8.0_45</div><div class="line">export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</div><div class="line">export PATH=$PATH:$JAVA_HOME/bin</div></pre></td></tr></table></figure>
<p>然后使用以下命令使得环境变量生效：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$source /etc/profile</div></pre></td></tr></table></figure></p>
<p>到此为止，JDK就安装完成了。查看JDK的版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$java –version</div><div class="line">java version &quot;1.8.0_45&quot;</div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_45-b14)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.45-b02, mixed mode)</div></pre></td></tr></table></figure></p>
<p>若以上命令没有成功显示版本信息，那有可能是之前的操作出现问题，请仔细检查之前的操作。</p>
<p><strong>Ant版本：1.9.4</strong><br>通过wget下载安装包:<br><a href="https://archive.apache.org/dist/ant/binaries/binaries/apache-ant-1.9.4-bin.tar.gz" target="_blank" rel="external">https://archive.apache.org/dist/ant/binaries/binaries/apache-ant-1.9.4-bin.tar.gz</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$ wget https://archive.apache.org/dist/ant/binaries/binaries/apache-ant-1.9.4-bin.tar.gz</div></pre></td></tr></table></figure>
<p>解压后可得到apache-ant-1.9.6这个文件夹，将其移动到/usr/local/ant文件夹中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$sudo tar -zvxf apache-ant-1.9.4-bin.tar.gz</div><div class="line">gannyee@ubuntu:~/download$sudo mkdir /usr/local/ant</div><div class="line">gannyee@ubuntu:~/download$mv apache-ant-1.9.4 /usr/local/ant</div></pre></td></tr></table></figure>
<p>打开profile设置环境变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$vim /etc/profile</div></pre></td></tr></table></figure></p>
<p>在profile文件末尾加入以下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export ANT_HOME=/usr/local/ant/apache-ant-1.9.4</div><div class="line">export PATH=$PATH:$ANT_HOME/bin</div></pre></td></tr></table></figure></p>
<p>使用以下命令使得环境变量生效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$source /etc/profile</div></pre></td></tr></table></figure>
<p>查看Ant版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$ant -version</div><div class="line">Apache Ant(TM) version 1.9.4 compiled on April 29 2014</div></pre></td></tr></table></figure>
<p>至此，配置引擎所需的环境预先配置完成！</p>
<p></p><h5><strong>引擎数据流如图示：</strong><p></p>
<p>图片来源博客：<a href="http://www.aossama.com/search-engine-with-apache-nutch-mongodb-and-elasticsearch/" target="_blank" rel="external">http://www.aossama.com/search-engine-with-apache-nutch-mongodb-and-elasticsearch/</a></p>
<p><img src="http://www.aossama.com/wp-content/uploads/2015/03/Post-538.png" alt="这里写图片描述"></p>
<p></p><h5><strong>Mongodb下载、安装、启动</strong><p></p>
<p>开源文档数据库，Nosql数据典型代表之一。<br>版本：MongoDB-2.6.11<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$ wget https://fastdl.mongodb.org/src/mongodb-src-r2.6.11.tar.gz</div><div class="line">gannyee@ubuntu:~/download$ sudo tar -zxvf mongodb-src-r2.6.11.tar.gz</div><div class="line">gannyee@ubuntu:~/download$ mv mongodb-src-r2.6.11/ ../mongodb/</div><div class="line">gannyee@ubuntu:~$cd mongodb/</div><div class="line">gannyee@ubuntu:~/mongodb$ </div><div class="line">sudo mkdir log/ conf/ data/</div></pre></td></tr></table></figure></p>
<p>从2.6版开始,mongodb使用YAML-based配置文件格式。参考下面的配置可以在<a href="http://docs.mongodb.org/v2.6/reference/configuration-options/" target="_blank" rel="external">这里找到</a>。</p>
<p>创建se.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/mongodb$ vim conf/se.yml</div><div class="line">net:</div><div class="line">  port: 27017</div><div class="line">  bindIp: 127.0.0.1</div><div class="line">systemLog:</div><div class="line">  destination: file</div><div class="line">  path: &quot;/opt/mongodb/log/mongodb.log&quot;</div><div class="line">  logAppend: true</div><div class="line">processManagement:</div><div class="line">  fork: true</div><div class="line">  pidFilePath: &quot;/opt/mongodb/log/mongodb.pid&quot;</div><div class="line">storage:</div><div class="line">  dbPath: &quot;/opt/mongodb/data&quot;</div><div class="line">  directoryPerDB: true</div><div class="line">  smallFiles: true</div></pre></td></tr></table></figure>
<p> 启动Mongodb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/mongodb$ ./bin/mongod -f conf/se.yml</div></pre></td></tr></table></figure>
<p> 进入Mongodb以检查Mongodb是否启动成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/mongodb$ ./bin/mongo</div><div class="line">MongoDB shell version: 2.6.11</div><div class="line">connecting to: test</div><div class="line">&gt; show dbs</div><div class="line">admin (empty)</div><div class="line">local 0.031GB</div><div class="line">&gt; exit</div><div class="line">bye</div></pre></td></tr></table></figure>
<p>关闭Mongodb：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;use admin</div><div class="line">&gt;db.shutdownServer()</div></pre></td></tr></table></figure>
<blockquote>
<p>如Ubuntu使用Mongodb的图形化界面管理工具，推荐使用robomongo<br>下载地址：<br><a href="http://app.robomongo.org/files/linux/robomongo-0.8.5-x86_64.deb" target="_blank" rel="external">http://app.robomongo.org/files/linux/robomongo-0.8.5-x86_64.deb</a><br>使用robomongo链接数据库<br>下载、安装robomongo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/mongodb$ sudo wget http://app.robomongo.org/files/linux/robomongo-0.8.5-x86_64.deb</div><div class="line">gannyee@ubuntu:~/mongodb$sudo dpkg -i robomongo-0.8.5-x86_64.deb</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~$robomongo就可以打开客户端。<br> 建立新连接，只需要添加host和port即可。<br> note：我第一次安装成功后链接也成功，但是看不到任何数据。<br> 解决办法：重新使用root权限安装即可。<br> <strong>软件界面如图所示：</strong><br> <img src="http://img.blog.csdn.net/20160127234110647" alt="这里写图片描述"><br>如果需要外网访问的话，需要配置文件中的bindIp: 127.0.0.1改为bindIp: 0.0.0.0</p>
</blockquote>
<p>然后在浏览器中输入：<a href="http://localhost:27017,如果出现以下内容，说明外网可以访问：" target="_blank" rel="external">http://localhost:27017,如果出现以下内容，说明外网可以访问：</a><br><strong>It looks like you are trying to access MongoDB over HTTP on the native driver port.</strong></p>
<blockquote>
<p>如果出现无法执行./mongod的错误<br>大部分是因为mongodb 服务在不正常关闭的情况下,mongod 被锁,想想可能是上次无故死机造成的.<br><strong>如何解决这种问题:</strong></p>
<blockquote>
<p>删除 mongod.lock 文件和日志文件 mongodb.log.2016-1-26T06-55-20 ,如果有必要把 log日志全部删除<br>mongod –repair –dbpath /home/gannyee/mongodb/data/db / –repairpath  /home/gannyee/mongodb</p>
</blockquote>
</blockquote>
<p></p><h5><strong>ElasticSearch下载、安装</strong><p></p>
<p>从Apache Lucene提取高性能的分布式搜索引擎。<br>版本：ElastricSearch-1.4.4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.4.4.tar.gz</div><div class="line">gannyee@ubuntu:~/download$tar -zxvf elasticsearch-1.4.4.tar.gz</div><div class="line">gannyee@ubuntu:~/download$ mv elasticsearch-1.4.4 ../elasticsearch </div><div class="line">gannyee@ubuntu:~$cd /elasticsearch</div></pre></td></tr></table></figure>
<p>修改config下文件elasticsearch.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/elasticsearch$ vim config/elasticsearch.yml</div><div class="line">......</div><div class="line">cluster.name: gannyee</div><div class="line">node.name: &quot;gannyee&quot;</div><div class="line">node.master: true</div><div class="line">node.data: true</div><div class="line">path.conf: /home/gannyee/elasticsearch/config</div><div class="line">path.data: /home/gannyee/elasticsearch/data</div><div class="line">http.enabled: true</div><div class="line">network.bind_host: 127.0.0.1</div><div class="line">network.publish_host: 127.0.0.1</div><div class="line">network.host: 127.0.0.1</div><div class="line">.......</div></pre></td></tr></table></figure>
<p> 后台启动ElasticSearch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/elasticsearch$ ./bin/elasticsearch -d</div></pre></td></tr></table></figure>
<p> 终止ElasticSearch进程<br>关闭单一节点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/elasticsearch$curl -XPOST </div><div class="line">http://localhost:9200/_cluster/nodes/_shutdown</div></pre></td></tr></table></figure>
<p>关闭节点BlrmMvBdSKiCeYGsiHijdg<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/elasticsearch$curl –XPOST </div><div class="line">http://localhost:9200/_cluster/nodes/BlrmMvBdSKiCeYGsiHijdg/_shutdown</div></pre></td></tr></table></figure></p>
<p> 检测是否成功运行ElasticSearch</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/elasticsearch$ curl -XGET &apos;http://localhost:9200&apos;</div><div class="line">&#123;</div><div class="line">  &quot;status&quot; : 200,</div><div class="line">  &quot;name&quot; : &quot;gannyee&quot;,</div><div class="line">  &quot;cluster_name&quot; : &quot;gannyee&quot;,</div><div class="line">  &quot;version&quot; : &#123;</div><div class="line">    &quot;number&quot; : &quot;1.4.4&quot;,</div><div class="line">    &quot;build_hash&quot; : &quot;c88f77ffc81301dfa9dfd81ca2232f09588bd512&quot;,</div><div class="line">    &quot;build_timestamp&quot; : &quot;2015-02-19T13:05:36Z&quot;,</div><div class="line">    &quot;build_snapshot&quot; : false,</div><div class="line">    &quot;lucene_version&quot; : &quot;4.10.3&quot;</div><div class="line">  &#125;,</div><div class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>elasticsearch-head是一个elasticsearch的集群管理工具，它是完全由html5编写的独立网页程序，你可以通过插件把它集成到es<br>安装 elasticsearch-head插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/elasticsearch$ cd elasticsearch</div><div class="line">gannyee@ubuntu:~/elasticsearch$ ./bin/plugin -install mobz/elasticsearch-head</div></pre></td></tr></table></figure>
<p>运行重启elasticsearch<br>在浏览器输入:<a href="http://localhost:9200/_plugin/head/" target="_blank" rel="external">http://localhost:9200/_plugin/head/</a><br>界面的右边有些按钮，如：node stats， cluster nodes，这些是直接请求es的相关状态的api，返回结果为json，如下图：<br><img src="http://img.blog.csdn.net/20160127233837852" alt="这里写图片描述"></p>
<p></p><h5><strong>Kibana下载、安装</strong><p></p>
<p>基于分析和搜索Elasticsearch仪表板的开源浏览器<br>版本：kibana-4.0.1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$wget https://download.elasticsearch.org/kibana/kibana/kibana-4.0.1-linux-x64.tar.gz</div><div class="line">gannyee@ubuntu:~/download$ tar -zxvf /download kibana-4.0.1-linux-x64.tar.gz </div><div class="line">gannyee@ubuntu:~/download$mv kibana-4.0.1-linux-x64/ ../kibana/ </div><div class="line">gannyee@ubuntu:~/download$cd ../kibana/</div><div class="line">gannyee@ubuntu:~/kibana$ ./bin/kibana</div></pre></td></tr></table></figure>
<p> 下面你就可以通过<a href="http://127.0.0.1:5601端口访问了,界面如图所示：" target="_blank" rel="external">http://127.0.0.1:5601端口访问了,界面如图所示：</a><br><img src="http://img.blog.csdn.net/20160127233947509" alt="这里写图片描述"></p>
<p></p><h5><strong>Apache Nutch 安装、编译、配置：</strong><p></p>
<p>在Lucene发展来的开源网络爬虫，本次配置只能使用nutch2.x系列，1.x系列不支持MongoDB等其他如Mysql,Habase数据库。<br>版本：apache-nutch-2.3.1</p>
<p>Nutch2.3下载、编译、配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/download$  wget</div><div class="line">http://www.apache.org/dyn/closer.lua/nutch/2.3.1/apache-nutch-2.3.1-src.tar.gz</div><div class="line">gannyee@ubuntu:~/download$ tar -zxvf apache-nutch-2.3.1-src.tar.gz</div><div class="line">gannyee@ubuntu:~/download$  mv apache-nutch-2.3.1 ../nutch</div><div class="line">gannyee@ubuntu:~/download$ cd ../nutch</div><div class="line">gannyee@ubuntu:~/nutch$ export NUTCH_HOME=$(pwd)</div></pre></td></tr></table></figure>
<p>修改/conf/nutch-site.xml使Mongodb作为GORA的存储单元</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/nutch/conf$ vim nutch-site.conf</div><div class="line">&lt;configuration&gt;</div><div class="line">  &lt;property&gt;</div><div class="line">    &lt;name&gt;storage.data.store.class&lt;/name&gt;</div><div class="line">    &lt;value&gt;org.apache.gora.mongodb.store.MongoStore&lt;/value&gt;</div><div class="line">    &lt;description&gt;Default class for storing data&lt;/description&gt;</div><div class="line">  &lt;/property&gt;</div><div class="line">&lt;/configuration&gt;</div></pre></td></tr></table></figure>
<p>从/ivy/ivy.xml文件中取消下面部分的注释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/nutch/conf$  vim $NUTCH_HOME/ivy/ivy.xml</div><div class="line">&lt;dependency org=&quot;org.apache.gora&quot; name=&quot;gora-mongodb&quot; rev=&quot;0.5&quot; conf=&quot;*-&gt;default&quot; /&gt;</div><div class="line">...</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<p>确保MongoStore设置为默认数据存储</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">gannyee@ubuntu:~/nutch$ vim conf/gora.properties</div><div class="line">/#######################</div><div class="line">/# MongoDBStore properties #</div><div class="line">/#######################</div><div class="line">gora.datastore.default=org.apache.gora.mongodb.store.MongoStore</div><div class="line">gora.mongodb.override_hadoop_configuration=false</div><div class="line">gora.mongodb.mapping.file=/gora-mongodb-mapping.xml</div><div class="line">gora.mongodb.servers=localhost:27017</div><div class="line">gora.mongodb.db=nutch</div><div class="line">``` </div><div class="line">开始编译nutch</div></pre></td></tr></table></figure>
<p>gannyee@ubuntu:~/nutch$ant runtime<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">如果编译过程中有如下错误</div></pre></td></tr></table></figure></p>
<p>Trying to override old definition of task javac<br>  [taskdef] Could not load definitions from resource org/sonar/ant/antlib.xml. It could not be found.</p>
<p>ivy-probe-antlib:</p>
<p>ivy-download:<br>  [taskdef] Could not load definitions from resource org/sonar/ant/antlib.xml. It could not be found.</p>
<p>Trying to override old definition of task javac<br>  [taskdef] Could not load definitions from resource org/sonar/ant/antlib.xml. It could not be found.</p>
<p>ivy-probe-antlib:</p>
<p>ivy-download:<br>  [taskdef] Could not load definitions from resource org/sonar/ant/antlib.xml. It could not be found.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">是因为缺少lib包，解决办法如下（其实可以无视）：</div><div class="line">下载 sonar-ant-task-2.1.jar，拷贝到 $NUTCH_HOME/lib 目录下面</div><div class="line"></div><div class="line">修改 $NUTCH_HOME/build.xml，引入上面添加</div></pre></td></tr></table></figure></p>
<!-- Define the Sonar task if this hasn't been done in a common script -->
<p> <taskdef uri="antlib:org.sonar.ant" resource="org/sonar/ant/antlib.xml"><br>  <classpath path="${ant.library.dir}"><br>  <classpath path="${mysql.library.dir}"><br>  <classpath><fileset dir="lib/" includes="sonar*.jar"></fileset></classpath><br> </classpath></classpath></taskdef><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> 编译后的文件将被放在新生成的文件夹/nutch/runtime中</div><div class="line"></div><div class="line">最后确认nutch已经正确地编译和运行,输出如下：</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~/nutch/runtime/local$ ./bin/nutch<br> Usage: nutch COMMAND<br>where COMMAND is one of:<br> inject         inject new urls into the database<br> hostinject     creates or updates an existing host table from a text file<br> generate       generate new batches to fetch from crawl db<br> fetch          fetch URLs marked during generate<br> parse          parse URLs marked during fetch<br> updatedb       update web table after parsing<br> updatehostdb   update host table after parsing<br> readdb         read/dump records from page database<br> readhostdb     display entries from the hostDB<br> index          run the plugin-based indexer on parsed batches<br> elasticindex   run the elasticsearch indexer - DEPRECATED use the index command instead<br> solrindex      run the solr indexer on parsed batches - DEPRECATED use the index command instead<br> solrdedup      remove duplicates from solr<br> solrclean      remove HTTP 301 and 404 documents from solr - DEPRECATED use the clean command instead<br> clean          remove HTTP 301 and 404 documents and duplicates from indexing backends configured via plugins<br> parsechecker   check the parser for a given url<br> indexchecker   check the indexing filters for a given url<br> plugin         load a plugin and run one of its classes main()<br> nutchserver    run a (local) Nutch server on a user defined port<br> webapp         run a local Nutch web application<br> junit          runs the given JUnit test<br> or<br> CLASSNAME      run the class named CLASSNAME<br>Most commands print help when invoked w/o parameters.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">定制你的爬取特性</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~$ sudo vim /nutch/runtime/local/conf/nutch-site.xml</p>
<p>&lt; ?xml version=”1.0”?&gt;<br>&lt; ?xml-stylesheet type=”text/xsl” href=”configuration.xsl”?&gt;</p>
<!-- Put site-specific property overrides in this file. -->
<p><configuration><br>  <property><br>    <name>storage.data.store.class</name><br>    <value>org.apache.gora.mongodb.store.MongoStore</value><br>    <description>Default class for storing data</description><br>  </property></configuration></p>
  <property><br>    <name>http.agent.name</name><br>    <value>Hist Crawler</value><br>  </property>

  <property><br>    <name>plugin.includes</name><br>    <value>protocol-(httphttpclient)urlfilter-regexindex-(basicmore)query-(basicsiteurllang)indexer-elasticnutch-extensionpointsparse-(texthtmlmsexcelmswordmspowerpointpdf)summary-basicscoring-opicurlnormalizer-(passregexbasic)parse-(htmltikametatags)index-(basicanchormoremetadata)</value><br>  </property><br>  <property><br>    <name>elastic.host</name><br>    <value>localhost</value><br>  </property>

  <property><br>    <name>elastic.cluster</name><br>    <value>hist</value><br>  </property>

  <property><br>    <name>elastic.index</name><br>    <value>nutch</value><br>  </property>

  <property><br>    <name>parser.character.encoding.default</name><br>    <value>utf-8</value><br>  </property>

  <property><br>    <name>http.content.limit</name><br>    <value>6553600</value><br>  </property>

<p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;h5&gt;爬取自己第一个网页</div><div class="line">创建一个URL种子列表</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~$ mkdir -p /nutch/runtime/local/urls<br>gannyee@ubuntu:~$ echo ‘<a href="http://www.aossama.com/" target="_blank" rel="external">http://www.aossama.com/</a>‘ &gt;/nutch/runtime/local/urls/seed.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">编辑conf/regex-urlfilter.txt文件，并且替换以下内容</div></pre></td></tr></table></figure></p>
<p>/# accept anything else<br>+.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">使用正则表达式匹配你想要爬取的域名</div></pre></td></tr></table></figure></p>
<p>+^<a href="http://([a-z0-9]*\.)*aossama.com/" target="_blank" rel="external">http://([a-z0-9]*\.)*aossama.com/</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">**初始化crawldb**</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~/nutch/runtime/local$  ./bin/nutch inject urls/<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">**从 crawldb生成urls**</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~/nutch/runtime/local$  ./bin/nutch generate -topN 80<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">**获取生成的所有urls**</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~/nutch/runtime/local$ ./bin/nutch fetch -all<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">**解析获取的urls**</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~/nutch/runtime/local$./ bin/nutch parse -all<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">**更新database数据库**</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~/nutch/runtime/local$  ./bin/nutch updatedb -all<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">**索引解析的urls**</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~/nutch/runtime/local$ bin/nutch index -all<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">爬取完给定网页，mongoDB会生成一个新的数据库：nutch_1</div></pre></td></tr></table></figure></p>
<p>gannyee@ubuntu:~/mongodb$ ./bin/mongo<br>MongoDB shell version: 2.6.11<br>connecting to: test</p>
<blockquote>
<p>show dbs<br>admin    (empty)<br>local    0.031GB<br>nutch_1  0.031GB<br>test     (empty)<br>use nutch_1<br>switched to db nutch_1<br>show tables<br>system.indexes<br>webpage</p>
</blockquote>
<p>```<br>具体数据可以在terminal下用指令或在图形界面下直接点击查看！</p>
<p>参考博客：<br>【1】<br><a href="http://www.aossama.com/search-engine-with-apache-nutch-mongodb-and-elasticsearch/" target="_blank" rel="external">http://www.aossama.com/search-engine-with-apache-nutch-mongodb-and-elasticsearch/</a><br>【2】<a href="http://www.micmiu.com/opensource/nutch/nutch2x-tutorial/" target="_blank" rel="external">http://www.micmiu.com/opensource/nutch/nutch2x-tutorial/</a><br>【3】<a href="http://www.jeepshoe.org/82645084.htm" target="_blank" rel="external">http://www.jeepshoe.org/82645084.htm</a><br>【4】<a href="http://yijiebuyi.com/blog/f2e849b336b4d27fbf91bc52735d7841.html" target="_blank" rel="external">http://yijiebuyi.com/blog/f2e849b336b4d27fbf91bc52735d7841.html</a></p>
</h5></h5></h5></h5></h5></h5></h5>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/16/Nutch+MongoDB+ElasticSearch+Kibana 搭建搜索引擎/" data-id="cit5y2qfx0000oot5c31qg0ee" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/16/hello-world/" class="article-date">
  <time datetime="2016-09-16T15:13:16.421Z" itemprop="datePublished">2016-09-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/16/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/16/hello-world/" data-id="cit5y2qgu0001oot5wb34sjhn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Exercise-在此处输入这篇文章的分类。/">Exercise   //在此处输入这篇文章的分类。</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/09/16/Nutch+MongoDB+ElasticSearch+Kibana 搭建搜索引擎/">hello-world   //在此处添加你的标题。</a>
          </li>
        
          <li>
            <a href="/2016/09/16/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 gannyee<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>